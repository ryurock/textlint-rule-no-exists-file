{"version":3,"sources":["../src/index.ts"],"names":["fs","require","report","context","options","allows","Syntax","RuleError","getSource","Link","node","matched","url","match","filePath","getFilePath","currentPath","process","env","PWD","fileBasePath","path","dirname","resolvePath","join","replace","existsSync","text","isIgnored","some","allow","includes","ruleError"],"mappings":";;;;;;;AAIA;;;;;;AAFA,IAAMA,EAAE,GAAGC,OAAO,CAAC,IAAD,CAAlB;;AAQA,IAAMC,MAAmC,GAAG,gBAACC,OAAD,EAAyD;AAAA,MAA1BC,OAA0B,uEAAP,EAAO;AACjG,MAAMC,MAAM,GAAGD,OAAO,CAACC,MAAR,IAAkB,EAAjC;AACA,MAAM;AAACC,IAAAA,MAAD;AAASC,IAAAA,SAAT;AAAoBL,IAAAA,MAApB;AAA4BM,IAAAA;AAA5B,MAAyCL,OAA/C;AACA,SAAO;AACH,KAACG,MAAM,CAACG,IAAR,EAAcC,IAAd,EAA6B;AACzB;AACA,UAAIC,OAAO,GAAGD,IAAI,CAACE,GAAL,CAASC,KAAT,CAAe,KAAf,CAAd;AACA,UAAIF,OAAJ,EAAa,OAHY,CAIzB;;AACAA,MAAAA,OAAO,GAAGD,IAAI,CAACE,GAAL,CAASC,KAAT,CAAe,iBAAf,CAAV;AACA,UAAI,CAACF,OAAL,EAAc;AAEd,UAAMG,QAAQ,GAAGX,OAAO,CAACY,WAAR,EAAjB;AACA,UAAID,QAAQ,IAAI,IAAhB,EAAsB;AAEtB,UAAME,WAAW,GAAGC,OAAO,CAACC,GAAR,CAAYC,GAAhC;AACA,UAAIH,WAAW,IAAI,IAAnB,EAAyB,OAZA,CAczB;;AACA,UAAIN,IAAI,CAACE,GAAL,CAASC,KAAT,CAAe,QAAf,CAAJ,EAA8B;AAC1B,YAAMO,YAAY,GAAGC,IAAI,CAACC,OAAL,CAAaR,QAAb,CAArB,CAD0B,CAE1B;;AACA,YAAMS,WAAW,GAAGF,IAAI,CAACG,IAAL,CAAUJ,YAAV,EAAyBV,IAAI,CAACE,GAAN,CAAqBa,OAArB,CAA6B,OAA7B,EAAsC,EAAtC,CAAxB,CAApB;AACA,YAAIzB,EAAE,CAAC0B,UAAH,CAAcH,WAAd,MAA+B,KAAnC,EAA0C;AAE1C,YAAMI,IAAI,GAAGnB,SAAS,CAACE,IAAD,CAAtB,CAN0B,CAMI;;AAC9B,YAAMkB,SAAS,GAAGvB,MAAM,CAACwB,IAAP,CAAYC,KAAK,IAAIH,IAAI,CAACI,QAAL,CAAcD,KAAd,CAArB,CAAlB;AACA,YAAIF,SAAJ,EAAe;AAEf,YAAMI,SAAS,GAAG,IAAIzB,SAAJ,oIAA2CoB,IAA3C,EAAlB;AACA,eAAOzB,MAAM,CAACQ,IAAD,EAAOsB,SAAP,CAAb;AACH,OA3BwB,CA6BzB;;;AACA,UAAItB,IAAI,CAACE,GAAL,CAASC,KAAT,CAAe,UAAf,CAAJ,EAAgC;AAC5B;AACA,YAAMU,YAAW,GAAGF,IAAI,CAACG,IAAL,CAAUR,WAAV,EAAwBN,IAAI,CAACE,GAAN,CAAqBa,OAArB,CAA6B,KAA7B,EAAoC,EAApC,CAAvB,CAApB,CAF4B,CAG5B;;;AACA,YAAIzB,EAAE,CAAC0B,UAAH,CAAcH,YAAd,CAAJ,EAAgC;;AAEhC,YAAMI,KAAI,GAAGnB,SAAS,CAACE,IAAD,CAAtB,CAN4B,CAME;;;AAC9B,YAAMkB,UAAS,GAAGvB,MAAM,CAACwB,IAAP,CAAYC,KAAK,IAAIH,KAAI,CAACI,QAAL,CAAcD,KAAd,CAArB,CAAlB;;AACA,YAAIF,UAAJ,EAAe;;AAEf,YAAMI,UAAS,GAAG,IAAIzB,SAAJ,sGAAsCoB,KAAtC,EAAlB;;AACA,eAAOzB,MAAM,CAACQ,IAAD,EAAOsB,UAAP,CAAb;AACH;AACJ;;AA5CE,GAAP;AA8CH,CAjDD;;eAmDe9B,M","sourcesContent":["import { TxtNode } from \"@textlint/ast-node-types\";\nimport { TextlintRuleContext, TextlintRuleModule } from \"@textlint/types\";\nconst fs = require(\"fs\");\n\nimport * as path from \"path\";\n\nexport interface Options {\n    allows?: string[];\n}\n\nconst report: TextlintRuleModule<Options> = (context: TextlintRuleContext, options: Options = {}) => {\n    const allows = options.allows || [];\n    const {Syntax, RuleError, report, getSource} = context;\n    return {\n        [Syntax.Link](node: TxtNode) {\n            // アンカーは無視する\n            let matched = node.url.match(/^#/g);\n            if (matched) return;\n            // git の Current URL または 相対パス以外は無視する\n            matched = node.url.match(/^(\\.\\/|\\/(.*))/g);\n            if (!matched) return;\n\n            const filePath = context.getFilePath();\n            if (filePath == null) return;\n\n            const currentPath = process.env.PWD;\n            if (currentPath == null) return;\n\n            // 相対パスの場合\n            if (node.url.match(/^\\.\\//g)) {\n                const fileBasePath = path.dirname(filePath);\n                // アンカー(#) 以降を除去する\n                const resolvePath = path.join(fileBasePath, (node.url as string).replace(/#(.*)/, ''));\n                if (fs.existsSync(resolvePath) !== false) return;\n\n                const text = getSource(node); // Get text\n                const isIgnored = allows.some(allow => text.includes(allow));\n                if (isIgnored) return;\n\n                const ruleError = new RuleError(`相対パスのファイルが存在しませんでした Link: ${text}`);\n                return report(node, ruleError);\n            }\n\n            // Root Path 指定の場合\n            if (node.url.match(/^\\/(.*)/g)) {\n                // アンカー(#) 以降を除去する\n                const resolvePath = path.join(currentPath, (node.url as string).replace(/#.*/, ''));\n                // ファイルが存在した場合\n                if (fs.existsSync(resolvePath)) return;\n\n                const text = getSource(node); // Get text\n                const isIgnored = allows.some(allow => text.includes(allow));\n                if (isIgnored) return;\n\n                const ruleError = new RuleError(`ファイルが存在しませんでした Link: ${text}`);\n                return report(node, ruleError);\n            }\n        }\n    }\n};\n\nexport default report;"],"file":"index.js"}